<%- include ('./partials/header.ejs') %> 



<div class="container mt-4">
    <div class="input-group mb-3 col-md-5 mx-auto">
        <input type="search" id="regionText" class="form-control" placeholder="Search Regions e.g Technology, Dentistry..." aria-label="Search Regions" aria-describedby="basic-addon2">
        <div class="input-group-append">
          <button class="btn myBtn" type="button"><i class="fa fa-search" style="color: #BF1111;"></i></button>
        </div>
    </div>
    <div class="row" id="myRow">
        <!-- <div class="col-md-12 mx-auto"> -->
            <% regions.forEach(region => { %>
            <div class="col-md-4 mt-4"><a class= "specColor" href="/<%= region.slug %> "><i class="fa fa-angle-double-right"></i> <%= region.name %></a></div>
            <% }) %>
        <!-- </div> -->
    </div>

    <div class="d-flex justify-center">
        <a class="btn btn-outline-secondary col-sm-2 mx-auto mt-4 allBtn">See All <i class="fa fa-angle-down"></i></a>
    </div>
    
</div>

<!-- <ul class="list-group">

</ul> -->

<script>
$(function() {
    $('#regionText').keyup(function() {
        let val = $(this).val();

        $.ajax({
            method: 'GET',
            data: {
                q: val
            },
            url: '/api/regions/search',
            success: function(response) {
                let { regions } = response;
                let { count } = response;
                $('#myRow').html("")

                if (count == 0 && $('#regionText').val() !== "") {
                    $('#myRow').append(`<div class="col-md-12 mt-4 text-center"><span>No Regions Found for the specified string</span></div>`)
                    
                }
                else {
                    regions.forEach(region => {
                    $('#myRow').append(`<div class="col-md-4 mt-4"><a class="specColor" href="/${region.slug}"><i class="fa fa-angle-double-right"></i> ${region.name}</a></div>`) 
                    });

                    
                    ($('#regionText').val() == "")?$('.allBtn').css('display', 'block'):$('.allBtn').css('display', 'none') 
                        
                }
                
            },
            error: function(response) {
                console.log(response);
            }
        })
    })

    $('.allBtn').click(function() {
        $.ajax({
            method: 'GET',
            url: '/api/regions',
            success: function(response) {
                let { regions } = response;
                if ($('.allBtn').html() == 'See Less <i class="fa fa-angle-up"></i>') {
                    regions = regions.splice(0,21);
                }
                let { count } = response;
                $('#myRow').html("")

                regions.forEach(region => {
                    $('#myRow').append(`<div class="col-md-4 mt-4"><a class="specColor" href="/${region.slug}"><i class="fa fa-angle-double-right"></i> ${region.name}</a></div>`) 
                });

                if ($('.allBtn').html() == 'See Less <i class="fa fa-angle-up"></i>') {
                    $('.allBtn').html('See More <i class="fa fa-angle-down"></i>')
                }
                else {
                    $('.allBtn').html('See Less <i class="fa fa-angle-up"></i>')
                }
                
            }
        })
    })
})

</script>

<%- include ('./partials/footer.ejs') %> 